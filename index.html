<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…ØµÙ†Ø¹Ø© - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --accent-color: #ff9f43;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --bill-color: #9b59b6;
            --light-bg: #f4f7f6;
        }

        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background-color: var(--light-bg); }

        #welcome-screen {
            position: fixed; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?auto=format&fit=crop&w=1350&q=80');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; transition: 0.8s;
        }

        #welcome-screen h1 { color: white; font-size: 3rem; margin-bottom: 20px; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }

        #main-content { display: none; padding: 20px; opacity: 0; transition: 1s; }
        .container { max-width: 1500px; margin: auto; }

        header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 4px solid var(--primary-color); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; align-items: end; }
        
        input, select, button { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.85rem; }
        button { cursor: pointer; transition: 0.3s; font-weight: bold; border: none; }
        
        .btn-rent { background: var(--secondary-color); color: white; }
        .btn-bill { background: var(--bill-color); color: white; }
        .btn-update { background: #34495e; color: white; }

        .table-container { overflow-x: auto; background: white; border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; min-width: 1400px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.85rem; }
        th { background: #f8f9fa; color: #555; }

        .rent-section { background-color: #f0f7ff; }
        .bill-section { background-color: #fdf0ff; }

        .expiry-alert { color: white; background-color: var(--danger-color); padding: 4px; border-radius: 4px; font-weight: bold; }
        .expiry-warning { color: white; background-color: var(--accent-color); padding: 4px; border-radius: 4px; font-weight: bold; }

        .whatsapp-btn { background: #25D366; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; font-size: 0.8rem; font-weight: bold; display: inline-block; }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <h1>Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…ØµÙ†Ø¹Ø©</h1>
        <button onclick="startApp()" style="padding: 15px 40px; background: var(--accent-color); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>

    <div id="main-content">
        <div class="container">
            <header>
                <h2>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø± (Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ù†ÙØµÙ„Ø© ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù‚ÙˆØ¯)</h2>
                <div style="margin-top: 10px;">
                    <label>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø§Ù„Ùƒ: </label>
                    <input type="text" id="ownerPhone" placeholder="968XXXXXXXX" style="width: 160px; border-radius: 5px; border: none; padding: 5px;">
                </div>
            </header>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 15px;">
                <div class="card">
                    <h3>ğŸ  Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø¯ ÙˆØ§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</h3>
                    <div class="form-grid">
                        <div><label>Ø§Ù„Ù…Ø­Ù„</label><select id="shopId"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div>
                        <div><label>Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</label><input type="text" id="tenantName"></div>
                        <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label><input type="date" id="startDate"></div>
                        <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input type="date" id="endDate"></div>
                        <div><label>Ø§Ù„Ø¯ÙØ¹ ÙƒÙ„</label>
                            <select id="payCycle">
                                <option value="1">Ø´Ù‡Ø±</option><option value="2">Ø´Ù‡Ø±ÙŠÙ†</option><option value="3">3 Ø£Ø´Ù‡Ø±</option><option value="6">6 Ø£Ø´Ù‡Ø±</option><option value="12">Ø³Ù†Ø©</option>
                            </select>
                        </div>
                        <div><label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</label><input type="number" id="rentAmount"></div>
                        <button class="btn-update" onclick="updateShop()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù‚Ø¯</button>
                    </div>
                </div>

                <div class="card" style="border-top-color: var(--success-color)">
                    <h3>ğŸ’° ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹ Ù…Ø¨Ù„Øº</h3>
                    <div class="form-grid">
                        <div><label>Ø§Ù„Ù…Ø­Ù„</label><select id="payShopId"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div>
                        <div><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="payAmount"></div>
                        <div><label>Ø§Ù„Ø¬Ù‡Ø©</label><select id="payTarget"><option value="rent">Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</option><option value="bills">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</option></select></div>
                        <button class="btn-rent" onclick="addAction('pay')">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ âœ…</button>
                    </div>
                </div>

                <div class="card" style="border-top-color: var(--bill-color)">
                    <h3>ğŸ”Œ Ø¥Ø¶Ø§ÙØ© ÙÙˆØ§ØªÙŠØ±</h3>
                    <div class="form-grid">
                        <div><label>Ø§Ù„Ù…Ø­Ù„</label><select id="billShopId"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div>
                        <div><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="billAmount"></div>
                        <div><label>Ø§Ù„Ù†ÙˆØ¹</label><select id="billNote"><option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option><option value="Ù…Ø§Ø¡">Ù…Ø§Ø¡</option></select></div>
                        <button class="btn-bill" onclick="addAction('bill')">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø© â•</button>
                    </div>
                </div>
            </div>

            <div class="card table-container">
                <table>
                    <thead>
                        <tr>
                            <th rowspan="2">Ø§Ù„Ù…Ø­Ù„ / Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</th>
                            <th colspan="5" class="rent-section">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù‚ÙˆØ¯ (Ø±.Ø¹)</th>
                            <th colspan="3" class="bill-section">Ø­Ø³Ø§Ø¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Ø±.Ø¹)</th>
                            <th rowspan="2">Ø§Ù„ØªÙ‚Ø±ÙŠØ±</th>
                        </tr>
                        <tr>
                            <th class="rent-section">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                            <th class="rent-section">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                            <th class="rent-section">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                            <th class="rent-section">Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…</th>
                            <th class="rent-section">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯</th>
                            <th class="bill-section">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                            <th class="bill-section">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                            <th class="bill-section">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function startApp() {
            document.getElementById('welcome-screen').style.transform = 'translateY(-100%)';
            document.getElementById('main-content').style.display = 'block';
            setTimeout(() => { document.getElementById('main-content').style.opacity = '1'; }, 100);
            renderTable();
        }

        let shops = JSON.parse(localStorage.getItem('musannah_final_v5')) || [
            { id: 1, tenant: '-', rent: 0, rentPaid: 0, billsTotal: 0, billsPaid: 0, startDate: '', endDate: '', cycle: 1, logs: [] },
            { id: 2, tenant: '-', rent: 0, rentPaid: 0, billsTotal: 0, billsPaid: 0, startDate: '', endDate: '', cycle: 1, logs: [] },
            { id: 3, tenant: '-', rent: 0, rentPaid: 0, billsTotal: 0, billsPaid: 0, startDate: '', endDate: '', cycle: 1, logs: [] },
            { id: 4, tenant: '-', rent: 0, rentPaid: 0, billsTotal: 0, billsPaid: 0, startDate: '', endDate: '', cycle: 1, logs: [] }
        ];

        function updateShop() {
            const i = document.getElementById('shopId').value - 1;
            shops[i].tenant = document.getElementById('tenantName').value || '-';
            shops[i].rent = parseFloat(document.getElementById('rentAmount').value) || 0;
            shops[i].startDate = document.getElementById('startDate').value;
            shops[i].endDate = document.getElementById('endDate').value;
            shops[i].cycle = parseInt(document.getElementById('payCycle').value);
            save();
            alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø¯");
        }

        function addAction(type) {
            if(type === 'pay') {
                const i = document.getElementById('payShopId').value - 1;
                const amt = parseFloat(document.getElementById('payAmount').value);
                const target = document.getElementById('payTarget').value;
                if(!amt) return;
                if(target === 'rent') shops[i].rentPaid += amt; else shops[i].billsPaid += amt;
                document.getElementById('payAmount').value = '';
            } else {
                const i = document.getElementById('billShopId').value - 1;
                const amt = parseFloat(document.getElementById('billAmount').value);
                const note = document.getElementById('billNote').value;
                if(!amt) return;
                shops[i].billsTotal += amt;
                document.getElementById('billAmount').value = '';
            }
            save();
        }

        function save() {
            localStorage.setItem('musannah_final_v5', JSON.stringify(shops));
            localStorage.setItem('owner_phone', document.getElementById('ownerPhone').value);
            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            const phone = localStorage.getItem('owner_phone') || '';
            const today = new Date();

            shops.forEach(shop => {
                let nextPay = '-';
                if (shop.startDate) {
                    let d = new Date(shop.startDate);
                    while (d <= today) d.setMonth(d.getMonth() + shop.cycle);
                    nextPay = d.toISOString().split('T')[0];
                }

                let endClass = '';
                if (shop.endDate) {
                    const end = new Date(shop.endDate);
                    const diffDays = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
                    if (diffDays <= 0) endClass = 'expiry-alert';
                    else if (diffDays <= 30) endClass = 'expiry-warning';
                }

                let rentRem = shop.rent - shop.rentPaid;
                let billRem = shop.billsTotal - shop.billsPaid;

                const msg = `ğŸ¢ *ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„ ${shop.id}*%0AğŸ‘¤ ${shop.tenant}%0A------------------%0AğŸ  *Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±:*%0AØ§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${rentRem} Ø±.Ø¹%0AğŸ“… Ø§Ù„Ù‚Ø§Ø¯Ù…: ${nextPay}%0AâŒ› Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯: ${shop.endDate || '-'}%0A------------------%0AğŸ”Œ *Ø§Ù„ÙÙˆØ§ØªÙŠØ±:*%0AØ§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${billRem} Ø±.Ø¹`;

                tbody.innerHTML += `
                    <tr>
                        <td><b>#${shop.id}</b><br><small>${shop.tenant}</small></td>
                        <td class="rent-section">${shop.rent}</td>
                        <td class="rent-section">${shop.rentPaid}</td>
                        <td class="rent-section" style="font-weight:bold; color:${rentRem>0?'red':'green'}">${rentRem}</td>
                        <td class="rent-section">${nextPay}</td>
                        <td class="rent-section"><span class="${endClass}">${shop.endDate || '-'}</span></td>
                        <td class="bill-section">${shop.billsTotal}</td>
                        <td class="bill-section">${shop.billsPaid}</td>
                        <td class="bill-section" style="font-weight:bold; color:${billRem>0?'red':'green'}">${billRem}</td>
                        <td><a href="https://wa.me/${phone}?text=${msg}" target="_blank" class="whatsapp-btn">ÙˆØ§ØªØ³Ø§Ø¨ ğŸ’¬</a></td>
                    </tr>
                `;
            });
        }
    </script>
</body>
</html>