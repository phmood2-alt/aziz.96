<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام ذَوْد - التحليل الجنائي</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --dark-core: #0a0000;
            --primary-neon: #ff0000;
            --secondary-neon: #ff4d4d;
            --bg-panel: #1a0505;
            --text-main: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--dark-core); color: var(--text-main); overflow: hidden;
        }

        #landing-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(40,0,0,0.85)), 
                        url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; transition: 0.8s ease-in-out;
        }

        .welcome-box {
            text-align: center; backdrop-filter: blur(10px);
            padding: 50px; border-radius: 20px; border: 2px solid var(--primary-neon);
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.4);
        }

        .btn-enter {
            padding: 15px 40px; font-size: 1.5em; background: var(--primary-neon);
            color: white; border: none; border-radius: 50px; cursor: pointer;
            transition: 0.3s; font-weight: bold;
        }

        #main-system { display: flex; height: 100vh; opacity: 0; visibility: hidden; transition: 0.5s; }

        .sidebar {
            width: 480px; background: var(--bg-panel); padding: 20px;
            border-left: 3px solid var(--primary-neon); overflow-y: auto;
        }

        .section-title {
            color: var(--secondary-neon); font-size: 0.85em; margin: 15px 0 8px 0;
            border-bottom: 1px solid #441111; padding-bottom: 5px; font-weight: bold;
        }

        .input-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.7em; margin-bottom: 4px; color: #ffb3b3; }
        select, input {
            width: 100%; padding: 7px; background: #000; color: #fff;
            border: 1px solid #440000; border-radius: 4px; font-size: 0.8em;
        }

        .btn-add {
            background: #330000; color: var(--secondary-neon); border: 1px solid var(--secondary-neon);
            padding: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        .btn-predict {
            background: var(--primary-neon); color: white; border: none;
            padding: 15px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        #map { flex-grow: 1; position: relative; }
        .prediction-overlay {
            display: none; margin-top: 15px; padding: 15px;
            background: rgba(255, 0, 0, 0.15); border: 1px dashed var(--primary-neon); border-radius: 8px;
        }
    </style>
</head>
<body>

<div id="landing-page">
    <div class="welcome-box">
        <h1 style="color: var(--primary-neon); font-size: 4em; text-shadow: 0 0 20px var(--primary-neon);">نظام ذَوْد</h1>
        <p style="color: #fff;">التحليل الجنائي المتقدم - v6.2</p>
        <button class="btn-enter" onclick="enterSystem()">دخول النظام <i class="fas fa-shield-alt"></i></button>
    </div>
</div>

<div id="main-system">
    <div class="sidebar">
        <h2 style="text-align: center; color: var(--primary-neon);"><i class="fas fa-microchip"></i> وحدة التحليل ذَوْد</h2>
        
        <div class="section-title"><i class="fas fa-exclamation-triangle"></i> تفاصيل الحادثة</div>
        <div class="input-group">
            <label>نوع الجريمة</label>
            <select id="crimeType">
                <option>سرقة ممتلكات</option>  <option>القتل</option> <option>تقنية المعلومات </option> <option>سطو مسلح</option><option>تخريب</option>
                <option>اعتداء عنيف</option><option>اتجار غير مشروع</option>
            </select>
        </div>

        <div class="section-title"><i class="fas fa-brain"></i> تحليل الدافع </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>نوع الدافع</label>
                <select id="motiveType">
                    <option>مادي/ربحي</option>
                     <option>مادي/انتقامي</option>
                    <option>انتقامي/شخصي</option>
                    <option>أيديولوجي</option>
                    <option>عشوائي/سلوكي</option>
                </select>
            </div>
            <div class="input-group">
                <label>درجة الإلحاح</label>
                <select id="motiveUrgency">
                    <option>مخطط مسبقاً</option>
                    <option>وليد اللحظة</option>
                    <option>تحت ضغط خارجي</option>
                </select>
            </div>
        </div>

        <div class="section-title"><i class="fas fa-map-marked-alt"></i> التحليل الميداني </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>الثغرة المادية</label>
                <select id="fieldGap">
                    <option>ضعف الإضاءة</option>
                    <option>غياب الموانع الفيزيائية</option>
                    <option>طبيعة تضاريسية معقدة</option>
                    <option>مباني مهجورة</option>
                </select>
            </div>
            <div class="input-group">
                <label>الرقابة التقنية</label>
                <select id="techAudit">
                    <option>تعطل كاميرات</option>
                    <option>غياب أنظمة الإنذار</option>
                    <option>ضعف التغطية اللاسلكية</option>
                    <option>لا توجد رقابة تقنية</option>
                </select>
            </div>
            
        </div>

        <div class="section-title"><i class="fas fa-calendar-day"></i> السياق الزمني والبيئي</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>المناسبة الاجتماعية</label>
                <select id="socialEvent">
                    <option>يوم عادي</option>
                    <option>عيد / احتفال</option>
                    <option>فعالية جماهيرية</option>
                </select>
            </div>
            <div class="input-group">
                <label>توقيت الرواتب</label>
                <select id="salaryTime">
                    <option>أيام عادية</option>
                    <option>يوم الراتب</option>
                    <option>أسبوع الذروة المالية</option>
                </select>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>الفترة</label>
                <select id="timeOfDay">
                    <option>الليل</option><option>النهار</option><option>المساء</option>
                </select>
            </div>
            <div class="input-group">
                <label>حالة الطقس</label>
                <select id="weather">
                    <option>صافي</option><option>أمطار/ضباب</option><option>غبار</option>
                </select>
            </div>
        </div>

        <div class="input-group">
            <label>الإحداثيات</label>
            <input type="text" id="coords" value="24.71, 46.67" readonly style="color: var(--secondary-neon);">
        </div>

        <button class="btn-add" onclick="addNewIncident()"><i class="fas fa-plus-circle"></i> تثبيت البيانات</button>
        <button class="btn-predict" onclick="runPredictionAnalysis()"><i class="fas fa-sync-alt"></i> بدء التحليل التنبؤي</button>

        <div id="predictionResult" class="prediction-overlay">
            <h3 id="riskScore" style="margin: 0; font-size: 2em; color: var(--primary-neon);">0%</h3>
            <p id="analysisSummary" style="font-size: 0.85em;"></p>
        </div>
    </div>

    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    function enterSystem() {
        document.getElementById('landing-page').style.transform = 'translateY(-100%)';
        document.getElementById('main-system').style.opacity = '1';
        document.getElementById('main-system').style.visibility = 'visible';
        setTimeout(() => { map.invalidateSize(); }, 600);
    }

    let incidents = JSON.parse(localStorage.getItem('thawd_v6_2_data')) || [];
    let map = L.map('map').setView([24.71, 46.67], 12);
    let markersGroup = L.layerGroup().addTo(map);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const crimeIcon = L.divIcon({
        className: 'custom-pin',
        html: '<i class="fas fa-map-marker-alt fa-2x" style="color:#ff0000"></i>',
        iconSize: [30, 30], iconAnchor: [15, 30]
    });

    map.on('click', e => {
        document.getElementById('coords').value = `${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;
    });

    function addNewIncident() {
        const data = {
            id: Date.now(),
            type: document.getElementById('crimeType').value,
            motiveType: document.getElementById('motiveType').value,
            motiveUrgency: document.getElementById('motiveUrgency').value,
            fieldGap: document.getElementById('fieldGap').value,
            techAudit: document.getElementById('techAudit').value,
            event: document.getElementById('socialEvent').value,
            salary: document.getElementById('salaryTime').value,
            time: document.getElementById('timeOfDay').value,
            weather: document.getElementById('weather').value,
            coords: document.getElementById('coords').value.split(',').map(Number)
        };
        incidents.push(data);
        localStorage.setItem('thawd_v6_2_data', JSON.stringify(incidents));
        renderMarkers();
        alert("تم التثبيت بنجاح.");
    }

    function renderMarkers() {
        markersGroup.clearLayers();
        incidents.forEach(inc => {
            L.marker(inc.coords, {icon: crimeIcon}).addTo(markersGroup)
             .bindPopup(`<div style="color:#000; text-align:right;">
                <b>النوع:</b> ${inc.type}<br>
                <b>الدافع:</b> ${inc.motiveType}<br>
                <b>الثغرة:</b> ${inc.fieldGap}
             </div>`);
        });
    }

    function runPredictionAnalysis() {
        if(incidents.length === 0) return alert("لا توجد بيانات.");
        document.getElementById('predictionResult').style.display = 'block';
        const last = incidents[incidents.length - 1];
        let risk = 30;
        
        if(last.techAudit.includes("تعطل")) risk += 25;
        if(last.salary.includes("يوم الراتب")) risk += 25;
        if(last.motiveUrgency.includes("مخطط")) risk += 20;

        document.getElementById('riskScore').innerText = Math.min(risk, 100) + "%";
        document.getElementById('analysisSummary').innerText = `تنبيه: نمط الجريمة يعتمد على ثغرة (${last.fieldGap}) مع استغلال لظروف (${last.salary}).`;
    }

    window.onload = renderMarkers;
</script>
</body>
</html>



