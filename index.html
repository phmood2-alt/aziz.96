<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø°ÙÙˆÙ’Ø¯ - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… v6</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --dark-core: #050508;
            --primary-neon: #ff2e63;
            --secondary-neon: #08d9d6;
            --bg-panel: #10111a;
            --text-main: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--dark-core); color: var(--text-main); overflow: hidden;
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­ÙŠÙˆÙŠØ© */
        #landing-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                        url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; transition: 0.8s ease-in-out;
        }

        .welcome-box {
            text-align: center; backdrop-filter: blur(10px);
            padding: 50px; border-radius: 20px; border: 1px solid var(--primary-neon);
            box-shadow: 0 0 30px rgba(255, 46, 99, 0.3);
            animation: fadeIn 1.5s ease;
        }

        .welcome-box h1 { font-size: 4em; color: var(--primary-neon); margin: 0; text-shadow: 0 0 20px var(--primary-neon); }
        .welcome-box p { font-size: 1.2em; letter-spacing: 2px; margin-bottom: 30px; color: var(--secondary-neon); }

        .btn-enter {
            padding: 15px 40px; font-size: 1.5em; background: var(--primary-neon);
            color: white; border: none; border-radius: 50px; cursor: pointer;
            transition: 0.3s; font-weight: bold; text-transform: uppercase;
        }
        .btn-enter:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--primary-neon); }

        /* Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #main-system { 
            display: flex; height: 100vh; 
            opacity: 0; visibility: hidden; transition: 0.5s;
        }

        .sidebar {
            width: 480px; background: var(--bg-panel); padding: 20px;
            border-left: 3px solid var(--primary-neon); overflow-y: auto;
            box-shadow: 10px 0 30px rgba(0,0,0,0.5);
        }

        .section-title {
            color: var(--secondary-neon); font-size: 0.9em; margin: 15px 0 8px 0;
            border-bottom: 1px solid #333; padding-bottom: 5px; text-transform: uppercase;
        }

        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75em; margin-bottom: 4px; color: #aaa; }
        select, input, textarea {
            width: 100%; padding: 8px; background: #000; color: #fff;
            border: 1px solid #222; border-radius: 4px; font-size: 0.85em;
        }

        .btn-add {
            background: #252a34; color: var(--secondary-neon); border: 1px solid var(--secondary-neon);
            padding: 12px; width: 100%; font-weight: bold; cursor: pointer; transition: 0.3s;
            margin-top: 10px;
        }
        .btn-add:hover { background: var(--secondary-neon); color: #000; }

        /* Ù…ÙŠØ²Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .btn-delete {
            background: transparent; color: #ff4d4d; border: 1px solid #ff4d4d;
            padding: 8px; width: 100%; font-weight: bold; cursor: pointer; transition: 0.3s;
            margin-top: 5px; border-radius: 4px; font-size: 0.8em;
        }
        .btn-delete:hover { background: #ff4d4d; color: white; }

        .btn-predict {
            background: var(--primary-neon); color: white; border: none;
            padding: 15px; width: 100%; font-weight: bold; cursor: pointer;
            margin-top: 10px; box-shadow: 0 4px 15px rgba(255, 46, 99, 0.3);
        }

        #map { flex-grow: 1; position: relative; }

        .prediction-overlay {
            display: none; margin-top: 20px; padding: 15px;
            background: rgba(255, 46, 99, 0.1); border: 1px dashed var(--primary-neon);
            border-radius: 8px; animation: slideUp 0.5s ease;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .custom-pin { color: var(--primary-neon); text-shadow: 0 0 10px var(--primary-neon); }
    </style>
</head>
<body>

<div id="landing-page">
    <div class="welcome-box">
        <h1>Ù†Ø¸Ø§Ù… Ø°ÙÙˆÙ’Ø¯</h1>
        <p>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø§Ù„Ø°ÙƒÙŠ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©</p>
        <button class="btn-enter" onclick="enterSystem()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… <i class="fas fa-shield-alt"></i></button>
    </div>
</div>

<div id="main-system">
    <div class="sidebar">
        <h2 style="text-align: center; color: var(--primary-neon);"><i class="fas fa-microchip"></i> ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø°ÙÙˆÙ’Ø¯</h2>
        
        <div class="section-title"><i class="fas fa-file-medical"></i> ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
        
        <div class="input-group">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØªØ´ÙØ©</label>
            <select id="crimeType">
                <option>Ø³Ø±Ù‚Ø© Ù…Ù…ØªÙ„ÙƒØ§Øª</option><option>Ø³Ø·Ùˆ Ù…Ø³Ù„Ø­</option><option>ØªØ®Ø±ÙŠØ¨ ØªØ®Ø±ÙŠØ¨ÙŠ</option>
                <option>Ø§Ø¹ØªØ¯Ø§Ø¡ Ø¹Ù†ÙŠÙ</option><option>Ø§ØªØ¬Ø§Ø± ØºÙŠØ± Ù…Ø´Ø±ÙˆØ¹</option><option>Ø¬Ø±ÙŠÙ…Ø© ÙƒØ±Ø§Ù‡ÙŠØ©</option>
            </select>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>Ø§Ù„Ø¯Ø§ÙØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                <select id="motive">
                    <option>Ø¶Ø§Ø¦Ù‚Ø© Ù…Ø§Ù„ÙŠØ©/ÙÙ‚Ø±</option>
                    <option>Ø§Ù†ØªÙ‚Ø§Ù… Ø´Ø®ØµÙŠ</option>
                    <option>ØªØ£Ø«ÙŠØ± Ù…ÙˆØ§Ø¯ Ù…Ø®Ø¯Ø±Ø©</option>
                    <option>ØªØ·Ø±Ù/Ø£ÙŠØ¯ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                    <option>Ø§Ø¶Ø·Ø±Ø§Ø¨ Ø³Ù„ÙˆÙƒÙŠ</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ</label>
                <select id="rootCause">
                    <option>Ø¥Ù‡Ù…Ø§Ù„ Ø£Ù…Ù†ÙŠ/Ø£Ø¨ÙˆØ§Ø¨ Ù…ÙØªÙˆØ­Ø©</option>
                    <option>ØºÙŠØ§Ø¨ ØªØ§Ù… Ù„Ù„Ø¥Ø¶Ø§Ø¡Ø©</option>
                    <option>ØªØ¹Ø·Ù„ ÙƒØ§Ù…ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</option>
                    <option>Ø¹Ø²Ù„Ø© Ø§Ù„Ù…ÙƒØ§Ù† (Ù…Ù‡Ø¬ÙˆØ±)</option>
                    <option>ÙƒØ«Ø§ÙØ© Ø³ÙƒØ§Ù†ÙŠØ© ØªØ¹ÙŠÙ‚ Ø§Ù„Ø±ØµØ¯</option>
                </select>
            </div>
        </div>

        <div class="section-title"><i class="fas fa-cloud-sun"></i> Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„ÙˆÙ‚Øª</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>Ø§Ù„ÙØµÙ„</label>
                <select id="season">
                    <option>Ø§Ù„Ø´ØªØ§Ø¡ (Ù„ÙŠÙ„ Ø·ÙˆÙŠÙ„)</option><option>Ø§Ù„ØµÙŠÙ (Ù…ÙˆØ³Ù… Ø³ÙØ±)</option>
                    <option>Ø§Ù„Ø±Ø¨ÙŠØ¹</option><option>Ø§Ù„Ø®Ø±ÙŠÙ</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³</label>
                <select id="weather">
                    <option>ØµØ§ÙÙŠ</option><option>Ø¶Ø¨Ø§Ø¨ ÙƒØ«ÙŠÙ</option>
                    <option>Ø£Ù…Ø·Ø§Ø± Ø±Ø¹Ø¯ÙŠØ©</option><option>Ø¹Ø§ØµÙØ© ØºØ¨Ø§Ø±</option>
                </select>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>Ø§Ù„ÙØªØ±Ø©</label>
                <select id="timeOfDay">
                    <option>Ø§Ù„Ù„ÙŠÙ„ (00:00 - 05:00)</option>
                    <option>Ø§Ù„Ù†Ù‡Ø§Ø± (06:00 - 17:00)</option>
                    <option>Ø§Ù„Ù…Ø³Ø§Ø¡ (18:00 - 23:00)</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø§Ù„Ù…Ø±Ø¬Ø­Ø©</label>
                <input type="text" id="nationality" placeholder="Ù…Ø«Ø§Ù„: Ø¢Ø³ÙŠÙˆÙŠØŒ Ù…Ø­Ù„ÙŠ...">
            </div>
        </div>

        <div class="input-group">
            <label>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Ø­Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©)</label>
            <input type="text" id="coords" value="24.71, 46.67" readonly style="color: var(--secondary-neon);">
        </div>

        <button class="btn-add" onclick="addNewIncident()"><i class="fas fa-plus-circle"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø§Ø¯Ø«Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</button>
        <button class="btn-delete" onclick="deleteLastIncident()"><i class="fas fa-undo"></i> Ø­Ø°Ù Ø¢Ø®Ø± ÙˆØ§Ù‚Ø¹Ø© Ù…Ø³Ø¬Ù„Ø©</button>

        <div class="section-title" style="margin-top: 30px;"><i class="fas fa-brain"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªÙ†Ø¨Ø¤ÙŠ</div>
        <button class="btn-predict" onclick="runPredictionAnalysis()"><i class="fas fa-sync-alt"></i> ØªØ´ØºÙŠÙ„ Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤ ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø·</button>

        <div id="predictionResult" class="prediction-overlay">
            <h3 id="riskScore" style="margin: 0; font-size: 2em;">0%</h3>
            <p id="analysisSummary" style="font-size: 0.85em; line-height: 1.5;"></p>
            <div id="recomDetails" style="font-size: 0.8em; color: var(--secondary-neon);"></div>
        </div>
    </div>

    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // ÙˆØ¸ÙŠÙØ© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
    function enterSystem() {
        document.getElementById('landing-page').style.transform = 'translateY(-100%)';
        document.getElementById('main-system').style.opacity = '1';
        document.getElementById('main-system').style.visibility = 'visible';
        setTimeout(() => { map.invalidateSize(); }, 600);
    }

    let incidents = JSON.parse(localStorage.getItem('thawd_v6_data')) || [];
    let map = L.map('map').setView([24.71, 46.67], 12);
    let markersGroup = L.layerGroup().addTo(map);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const crimeIcon = L.divIcon({
        className: 'custom-pin',
        html: '<i class="fas fa-map-marker-alt fa-2x"></i>',
        iconSize: [30, 30],
        iconAnchor: [15, 30]
    });

    map.on('click', e => {
        document.getElementById('coords').value = `${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;
        let tempMarker = L.marker(e.latlng, {icon: crimeIcon, opacity: 0.5}).addTo(map);
        setTimeout(() => map.removeLayer(tempMarker), 2000);
    });

    function addNewIncident() {
        const coordsText = document.getElementById('coords').value;
        const coords = coordsText.split(',').map(Number);
        
        // Ù…ÙŠØ²Ø© ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ù…Ù†Ø·Ù‚Ø© Ù…Ø¹ÙŠÙ†Ø© (Ù†Ø·Ø§Ù‚ 500 Ù…ØªØ± ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹)
        const nearbyIncidents = incidents.filter(inc => {
            let dist = Math.sqrt(Math.pow(inc.coords[0]-coords[0], 2) + Math.pow(inc.coords[1]-coords[1], 2));
            return dist < 0.005; 
        });

        if(nearbyIncidents.length >= 2) {
            alert("ğŸš¨ ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ Ø¹Ø§Ø¬Ù„: ØªÙ… Ø±ØµØ¯ ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„ÙŠ Ù„Ù„Ø¬Ø±Ø§Ø¦Ù… ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (" + (nearbyIncidents.length + 1) + " Ø­ÙˆØ§Ø¯Ø«). ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ù„Ù„Ù…ÙˆÙ‚Ø¹ ÙÙˆØ±Ø§Ù‹.");
        }

        const data = {
            id: Date.now(),
            type: document.getElementById('crimeType').value,
            motive: document.getElementById('motive').value,
            cause: document.getElementById('rootCause').value,
            season: document.getElementById('season').value,
            weather: document.getElementById('weather').value,
            time: document.getElementById('timeOfDay').value,
            nation: document.getElementById('nationality').value,
            coords: coords
        };

        incidents.push(data);
        saveAndRender();
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.");
    }

    // Ù…ÙŠØ²Ø© Ø­Ø°Ù Ø§Ù„ÙˆØ§Ù‚Ø¹Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø®Ø·Ø£
    function deleteLastIncident() {
        if(incidents.length === 0) {
            alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ÙˆØ§Ø¯Ø« Ù…Ø³Ø¬Ù„Ø© Ù„Ø­Ø°ÙÙ‡Ø§.");
            return;
        }
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¢Ø®Ø± ÙˆØ§Ù‚Ø¹Ø© ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ø§ØŸ")) {
            incidents.pop();
            saveAndRender();
            alert("ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ§Ù‚Ø¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.");
        }
    }

    function saveAndRender() {
        localStorage.setItem('thawd_v6_data', JSON.stringify(incidents));
        renderMarkers();
    }

    function renderMarkers() {
        markersGroup.clearLayers();
        incidents.forEach(inc => {
            L.marker(inc.coords, {icon: crimeIcon}).addTo(markersGroup)
             .bindPopup(`
                <div style="color:#000; direction:rtl; text-align:right;">
                    <b>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©:</b> ${inc.type}<br>
                    <b>Ø§Ù„Ø³Ø¨Ø¨:</b> ${inc.cause}<br>
                    <b>Ø§Ù„Ø¯Ø§ÙØ¹:</b> ${inc.motive}<br>
                    <small>Ø§Ù„Ù…Ø¹Ø±Ù: ${inc.id}</small>
                </div>
             `);
        });
    }

    function runPredictionAnalysis() {
        if(incidents.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„.");
        
        document.getElementById('predictionResult').style.display = 'block';
        const last = incidents[incidents.length - 1];
        let risk = 30;
        let report = "";

        if(last.cause.includes("Ø¥Ø¶Ø§Ø¡Ø©") || last.cause.includes("Ù…Ù‡Ø¬ÙˆØ±")) risk += 30;
        if(last.time.includes("Ø§Ù„Ù„ÙŠÙ„") && last.weather !== "ØµØ§ÙÙŠ") risk += 20;
        if(last.season.includes("Ø§Ù„ØµÙŠÙ")) risk += 10;

        report = `Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§ÙØ¹ (${last.motive}) ÙˆØ§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ (${last.cause})ØŒ Ù†Ù„Ø§Ø­Ø¸ ÙˆØ¬ÙˆØ¯ Ø«ØºØ±Ø© Ø£Ù…Ù†ÙŠØ© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©. `;
        if(risk > 60) report += "Ø§Ù„Ù†Ù…Ø· ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø¬Ù†Ø§Ø© Ù„Ø¶Ø¹Ù Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© ÙÙŠ Ø¸Ø±ÙˆÙ " + last.weather;

        document.getElementById('riskScore').innerText = Math.min(risk, 100) + "%";
        document.getElementById('riskScore').style.color = risk > 60 ? "#ff2e63" : "#08d9d6";
        document.getElementById('analysisSummary').innerText = report;
        
        let recom = "âœ… Ø§Ù„ØªÙˆØµÙŠØ©: ";
        if(last.cause.includes("Ø¥Ø¶Ø§Ø¡Ø©")) recom += "ØªÙƒØ«ÙŠÙ Ø§Ù„Ø¥Ù†Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© ÙÙˆØ±Ø§Ù‹.";
        else if(last.cause.includes("ÙƒØ§Ù…ÙŠØ±Ø§Øª")) recom += "Ø¥Ø±Ø³Ø§Ù„ ÙØ±ÙŠÙ‚ ØµÙŠØ§Ù†Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ©.";
        else recom += "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª Ø§Ù„Ø±Ø§Ø¬Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª.";
        
        document.getElementById('recomDetails').innerText = recom;
    }

    window.onload = renderMarkers;
</script>
</body>
</html>
